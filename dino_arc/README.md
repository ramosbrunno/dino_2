# Dino Arc - Azure Resource Creator

## üéØ Vis√£o Geral

**Dino Arc** √© uma ferramenta CLI que automatiza a cria√ß√£o de recursos fundamentais no Azure usando Terraform. Com apenas 4 par√¢metros obrigat√≥rios de autentica√ß√£o, voc√™ cria uma infraestrutura completa e segura com:

- üì¶ **Resource Group** com nomenclatura padronizada
- üîê **Key Vault** com configura√ß√µes de seguran√ßa adequadas
- üë§ **Service Principal** com permiss√µes espec√≠ficas e credenciais seguras
- üè∑Ô∏è **Tags** autom√°ticas para governan√ßa

## üöÄ Recursos Principais

### ‚úÖ Cria√ß√£o Autom√°tica Completa
- Resource Group com tags de governan√ßa
- Key Vault com configura√ß√µes de produ√ß√£o
- Service Principal com permiss√µes adequadas
- Credenciais armazenadas automaticamente no Key Vault

### ‚úÖ Nomenclatura Consistente
Todos os recursos seguem o padr√£o `{projeto}-{ambiente}-{sufixo}`:
- Resource Group: `analytics-dev-rsg`
- Key Vault: `analytics-dev-akv-abc123`
- Service Principal: `analytics-dev-spn`

### ‚úÖ Configura√ß√µes de Seguran√ßa
- Service Principal com permiss√µes m√≠nimas necess√°rias
- Key Vault com access policies adequadas
- Credenciais armazenadas como secrets seguros
- Network access configurado adequadamente

## üõ†Ô∏è Instala√ß√£o

### Pr√©-requisitos
```bash
# Instalar Terraform (‚â• 1.0)
# Windows: https://www.terraform.io/downloads.html

# Instalar Azure CLI (para valida√ß√£o - opcional)
# Windows: https://docs.microsoft.com/en-us/cli/azure/install-azure-cli-windows

# ‚ö†Ô∏è IMPORTANTE: N√£o √© necess√°rio az login
# A ferramenta usa Service Principal para autentica√ß√£o
# Voc√™ precisa ter um Service Principal criado no Azure com as credenciais:
# - Client ID (Application ID)
# - Client Secret
# - Tenant ID
# - Subscription ID (onde os recursos ser√£o criados)
```

### Op√ß√£o 1: Instala√ß√£o como CLI Global (Recomendado)

#### Windows
```cmd
# Clonar o reposit√≥rio
git clone https://github.com/ramosbrunno/dino_2.git
cd dino_2\dino_arc

# Executar instalador autom√°tico
install.bat

# Ou manualmente
pip install -e .
```

#### Linux/MacOS
```bash
# Clonar o reposit√≥rio
git clone https://github.com/ramosbrunno/dino_2.git
cd dino_2/dino_arc

# Executar instalador autom√°tico
chmod +x install.sh
./install.sh

# Ou manualmente
pip install -e .
```

#### Verificar Instala√ß√£o
```bash
# Verificar se o comando est√° dispon√≠vel
dino-arc --help

# Exemplo de uso
dino-arc --action init --projeto "test"
```

### Op√ß√£o 2: Instala√ß√£o Tradicional (Desenvolvimento)
```bash
# Clonar o reposit√≥rio
git clone https://github.com/ramosbrunno/dino_2.git
cd dino_2/dino_arc

# Instalar depend√™ncias
pip install -r requirements.txt

# Usar diretamente
python src/cli.py --help
```

## üìã Uso R√°pido

### ‚ö° Comando CLI Global (Recomendado ap√≥s instala√ß√£o)
```bash
# Ver ajuda
dino-arc --help

# Criar infraestrutura completa (init executado automaticamente)
dino-arc \
  --client-id "12345678-1234-1234-1234-123456789012" \
  --client-secret "sua-client-secret-aqui" \
  --tenant_id "87654321-4321-4321-4321-210987654321" \
  --subscription-id "11111111-2222-3333-4444-555555555555" \
  --action apply \
  --projeto "analytics" \
  --ambiente "dev" \
  --location "East US"

# Visualizar plano (init executado automaticamente)
dino-arc \
  --client-id "12345678-1234-1234-1234-123456789012" \
  --client-secret "sua-client-secret-aqui" \
  --tenant_id "87654321-4321-4321-4321-210987654321" \
  --subscription-id "11111111-2222-3333-4444-555555555555" \
  --action plan \
  --projeto "analytics" \
  --ambiente "dev"
```

### ‚ö° Uso Tradicional (Desenvolvimento)
```bash
# Inicializar Terraform (primeira vez)
python src/cli.py \
  --client-id "12345678-1234-1234-1234-123456789012" \
  --client-secret "sua-client-secret-aqui" \
  --tenant_id "87654321-4321-4321-4321-210987654321" \
  --action init \
  --projeto "analytics"

# Criar infraestrutura completa (Foundation + Databricks Premium + Unity Catalog)
python src/cli.py \
  --client-id "12345678-1234-1234-1234-123456789012" \
  --client-secret "sua-client-secret-aqui" \
  --tenant_id "87654321-4321-4321-4321-210987654321" \
  --action apply \
  --projeto "analytics" \
  --ambiente "dev" \
  --location "East US"
```

### üìã Par√¢metros Obrigat√≥rios
- `--client-id`: Azure Client ID do Service Principal
- `--client-secret`: Azure Client Secret do Service Principal  
- `--tenant_id`: Azure Tenant ID
- `--subscription-id`: Azure Subscription ID (onde os recursos ser√£o criados)
- `--action`: A√ß√£o a executar (init, plan, apply, destroy)
- `--projeto`: Nome do projeto (base para nomenclatura)

### üìã Par√¢metros Opcionais
- `--ambiente`: Ambiente (dev, staging, prod) - **padr√£o: dev**
- `--location`: Localiza√ß√£o Azure - **padr√£o: East US**

### Comandos Dispon√≠veis

#### Com CLI Global (dino-arc)
```bash
# 1. Inicializar manualmente (opcional - executado automaticamente com outros comandos)
dino-arc --client-id "..." --client-secret "..." --tenant_id "..." --subscription-id "..." --action init --projeto "analytics"

# 2. Planejar recursos (init autom√°tico + visualizar sem criar)
dino-arc --client-id "..." --client-secret "..." --tenant_id "..." --subscription-id "..." --action plan --projeto "analytics" --ambiente "dev"

# 3. Criar infraestrutura completa (init autom√°tico + deploy + configurar Databricks)
dino-arc --client-id "..." --client-secret "..." --tenant_id "..." --subscription-id "..." --action apply --projeto "analytics" --ambiente "dev"

# 4. Destruir recursos (init autom√°tico + destroy)
dino-arc --client-id "..." --client-secret "..." --tenant_id "..." --subscription-id "..." --action destroy --projeto "analytics" --ambiente "dev"
```

#### Com Python Tradicional
```bash
# 1. Inicializar (primeira vez)
python src/cli.py --client-id "..." --client-secret "..." --tenant_id "..." --action init --projeto "analytics"

# 2. Planejar recursos (visualizar sem criar)
python src/cli.py --client-id "..." --client-secret "..." --tenant_id "..." --action plan --projeto "analytics" --ambiente "dev"

# 3. Criar infraestrutura completa + configurar Databricks automaticamente
python src/cli.py --client-id "..." --client-secret "..." --tenant_id "..." --action apply --projeto "analytics" --ambiente "dev"

# 4. Destruir recursos
python src/cli.py --client-id "..." --client-secret "..." --tenant_id "..." --action destroy --projeto "analytics" --ambiente "dev"
```

## üì¶ Recursos Criados Automaticamente

### üèõÔ∏è Foundation Module (Sempre Criado)
- **Resource Group**: `{projeto}-{ambiente}-rsg`
- **Key Vault**: `{projeto}-{ambiente}-akv-{random}`
- **Service Principal**: `{projeto}-{ambiente}-spn`

### üßÆ Databricks Premium Module (Sempre Criado)
- **Databricks Workspace**: `{projeto}-{ambiente}-dbw-{random}` (SKU Premium)
- **DBFS Storage Account**: `{projeto}{ambiente}dbwsa{random}`
- **Unity Catalog Storage**: `{projeto}{ambiente}ucsa{random}` (Data Lake Gen2)

### üóÑÔ∏è Unity Catalog (Configurado Automaticamente)
- **Metastore**: `unity-catalog-{region}`
- **Catalog**: `{projeto}_{ambiente}`
- **Schemas**: bronze, silver, gold, workspace (arquitetura medallion)

### ‚ö° Serverless Compute (Habilitado Automaticamente)
- **Serverless Compute**: Habilitado para workspace
- **SQL Warehouse**: `{projeto}-{ambiente}-warehouse` (Serverless Premium)

### üîê Secrets no Key Vault
- `databricks-workspace-url`: URL do workspace
- `databricks-workspace-id`: ID do workspace  
- `unity-catalog-storage-name`: Nome da storage account
- `unity-catalog-storage-key`: Chave de acesso
- `spn-client-id`: Application (Client) ID
- `spn-client-secret`: Client Secret
- `spn-tenant-id`: Tenant ID

## üéØ Exemplos de Uso

### Desenvolvimento
```bash
python src/cli.py \
  --client-id "12345678-1234-1234-1234-123456789012" \
  --client-secret "sua-client-secret-aqui" \
  --tenant_id "87654321-4321-4321-4321-210987654321" \
  --action apply \
  --projeto "webapp" \
  --ambiente "dev" \
  --location "East US"
```

### Staging
```bash
python src/cli.py \
  --client-id "12345678-1234-1234-1234-123456789012" \
  --client-secret "sua-client-secret-aqui" \
  --tenant_id "87654321-4321-4321-4321-210987654321" \
  --action apply \
  --projeto "webapp" \
  --ambiente "staging" \
  --location "East US 2"
```

### Produ√ß√£o
```bash
python src/cli.py \
  --client-id "12345678-1234-1234-1234-123456789012" \
  --client-secret "sua-client-secret-aqui" \
  --tenant_id "87654321-4321-4321-4321-210987654321" \
  --action apply \
  --projeto "webapp" \
  --ambiente "prod" \
  --location "Brazil South"
```

### Como Obter as Credenciais do Service Principal

#### Op√ß√£o 1: Usar Azure Portal
1. Acesse o [Azure Portal](https://portal.azure.com)
2. Navegue para **Azure Active Directory > App registrations**
3. Clique em **New registration**
4. Preencha o nome e clique em **Register**
5. Copie o **Application (client) ID** e **Directory (tenant) ID**
6. V√° em **Certificates & secrets > New client secret**
7. Copie o **Client secret value**

#### Op√ß√£o 2: Usar Azure CLI (se dispon√≠vel)
```bash
# Criar Service Principal
az ad sp create-for-rbac --name "dino-arc-sp" --role contributor

# Resultado (exemplo):
{
  "appId": "12345678-1234-1234-1234-123456789012",     # client_id
  "password": "sua-client-secret-aqui",                # client_secret  
  "tenant": "87654321-4321-4321-4321-210987654321"    # tenant_id
}
```

## üîí Seguran√ßa e Boas Pr√°ticas

### ‚ö†Ô∏è Importante - Seguran√ßa das Credenciais
```bash
# ‚ùå NUNCA fa√ßa isso (credenciais expostas)
python src/cli.py --client-secret "senha123" --action apply --projeto "test"

# ‚úÖ Use vari√°veis de ambiente
export AZURE_CLIENT_ID="12345678-1234-1234-1234-123456789012"
export AZURE_CLIENT_SECRET="sua-client-secret-aqui"
export AZURE_TENANT_ID="87654321-4321-4321-4321-210987654321"

python src/cli.py \
  --client-id "$AZURE_CLIENT_ID" \
  --client-secret "$AZURE_CLIENT_SECRET" \
  --tenant_id "$AZURE_TENANT_ID" \
  --action apply \
  --projeto "analytics"
```

### üõ°Ô∏è Recomenda√ß√µes de Seguran√ßa
1. **Nunca commitar credenciais** no c√≥digo ou reposit√≥rio
2. **Use vari√°veis de ambiente** para armazenar credenciais
3. **Rotacione secrets regularmente** (a cada 90 dias)
4. **Configure permiss√µes m√≠nimas** no Service Principal
5. **Monitor logs de acesso** no Azure AD
6. **Use Azure Key Vault** para credenciais em produ√ß√£o

## üìä Sa√≠da T√≠pica

```
üöÄ Criando infraestrutura completa para projeto 'analytics' no ambiente 'dev' em 'East US'...
üì¶ Resource Group: analytics-dev-rsg
üîê Key Vault: analytics-dev-akv-abc123
üë§ Service Principal: analytics-dev-spn
üßÆ Databricks Premium: analytics-dev-dbw-abc123
üìä Unity Catalog Storage: analyticsdevucsa123

‚úÖ Infraestrutura completa criada com sucesso!
üìã Componentes implantados:
   üèõÔ∏è  Foundation (Resource Group + Key Vault + Service Principal)
   üßÆ Databricks Premium (Unity Catalog + Serverless)

‚è≥ Aguardando recursos ficarem prontos para configura√ß√£o...

üîß Configurando Databricks Unity Catalog e Serverless...
üìã Obtendo outputs do Terraform...
‚úÖ Conectando ao Databricks: https://adb-1234567890123456.78.azuredatabricks.net

üóÑÔ∏è  Criando Unity Catalog Metastore...
‚úÖ Unity Catalog Metastore criado: unity-catalog-east-us

üìö Criando Catalog: analytics_dev...
‚úÖ Catalog criado: analytics_dev

üóÇÔ∏è  Criando Schemas...
‚úÖ Schema criado: analytics_dev.bronze
‚úÖ Schema criado: analytics_dev.silver  
‚úÖ Schema criado: analytics_dev.gold
‚úÖ Schema criado: analytics_dev.workspace

‚ö° Habilitando Serverless Compute...
‚úÖ Serverless Compute habilitado!

üè≠ Criando SQL Warehouse Serverless...
‚úÖ SQL Warehouse Serverless criado: analytics-dev-warehouse

üéä Deploy completo finalizado!
üöÄ Seu ambiente Databricks Premium est√° pronto para uso:
   üìä Unity Catalog configurado com arquitetura medallion
   ‚ö° Serverless Compute habilitado
   üè≠ SQL Warehouse Serverless criado
   üìö Catalog: analytics_dev
   üóÇÔ∏è  Schemas: bronze, silver, gold, workspace
```

## üîß Estrutura do Projeto

```
dino_arc/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ cli.py                    # Interface CLI principal
‚îÇ   ‚îú‚îÄ‚îÄ sdk/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ azure_auth.py         # Autentica√ß√£o Azure
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ terraform_executor.py # Execu√ß√£o Terraform
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.py              # Utilit√°rios
‚îÇ   ‚îî‚îÄ‚îÄ terraform/
‚îÇ       ‚îú‚îÄ‚îÄ main.tf               # Recursos principais
‚îÇ       ‚îú‚îÄ‚îÄ variables.tf          # Vari√°veis simplificadas
‚îÇ       ‚îî‚îÄ‚îÄ outputs.tf            # Sa√≠das completas
‚îú‚îÄ‚îÄ tests/                        # Testes automatizados
‚îú‚îÄ‚îÄ EXEMPLOS_CLI.md              # Exemplos detalhados
‚îú‚îÄ‚îÄ requirements.txt             # Depend√™ncias Python
‚îî‚îÄ‚îÄ setup.py                     # Configura√ß√£o do pacote
```

## üéØ Vantagens

‚úÖ **Deploy Completo**: Foundation + Databricks Premium + Unity Catalog em uma execu√ß√£o  
‚úÖ **Simplicidade**: Apenas 4 par√¢metros de autentica√ß√£o obrigat√≥rios (client-id, client-secret, tenant-id, subscription-id)  
‚úÖ **Seguran√ßa**: Service Principal com permiss√µes adequadas  
‚úÖ **Premium Features**: Databricks Premium com Unity Catalog e Serverless  
‚úÖ **Automa√ß√£o Total**: Configura√ß√£o completa sem intera√ß√£o manual  
‚úÖ **Consist√™ncia**: Nomenclatura padronizada  
‚úÖ **Governan√ßa**: Tags e auditoria autom√°ticas  
‚úÖ **Produ√ß√£o-Ready**: Configura√ß√µes otimizadas para produ√ß√£o  
‚úÖ **Arquitetura Medallion**: Schemas bronze, silver, gold pr√©-configurados

## üìö Documenta√ß√£o

- [Exemplos de Uso](EXEMPLOS_CLI.md) - Exemplos detalhados de todos os comandos
- [Terraform README](src/terraform/README.md) - Documenta√ß√£o da infraestrutura

## ü§ù Contribui√ß√£o

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/nova-feature`)
3. Commit suas mudan√ßas (`git commit -am 'Adiciona nova feature'`)
4. Push para a branch (`git push origin feature/nova-feature`)
5. Abra um Pull Request

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo LICENSE para mais detalhes.
